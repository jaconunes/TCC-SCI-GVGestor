unit uFormPadraoConsultaDetalhePEDSCI;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, uFormPadraoConsultaPEDSCI, Data.DB,
  System.ImageList, Vcl.ImgList, Vcl.Grids, Vcl.DBGrids, Vcl.ComCtrls,
  Vcl.ToolWin, Vcl.ExtCtrls, Datasnap.DBClient;

type
  TfrFormPadraoConsultaDetalhePEDSCI = class(TfrFormPadraoConsultaPEDSCI)
    DBGrid1: TDBGrid;
    Panel2: TPanel;
    DBGrid2: TDBGrid;
    tbInferior: TToolBar;
    btFiltrarDetalhe: TToolButton;
    ToolButton13: TToolButton;
    btExcluirDetalhe: TToolButton;
    Splitter1: TSplitter;
    dsDetalhe: TDataSource;
    procedure FormCreate(Sender: TObject);
    procedure btExcluirDetalheClick(Sender: TObject);
  private
    { Private declarations }
    FTabelaDetalhe : TClientDataSet;
  public
    { Public declarations }
    function setTabelaDetalhe      : TClientDataSet; virtual; abstract;
    function setCamposChaveDetalhe :  String; virtual; abstract;
    function getPodeExcluirDetalhe : Boolean; virtual;

  end;

var
  frFormPadraoConsultaDetalhePEDSCI: TfrFormPadraoConsultaDetalhePEDSCI;

implementation

{$R *.dfm}

{ TfrFormPadraoConsultaDetalhePEDSCI }

procedure TfrFormPadraoConsultaDetalhePEDSCI.btExcluirDetalheClick(
  Sender: TObject);
begin
  inherited;
  if getPodeExcluirDetalhe and Assigned(FTabelaDetalhe) and (not FTabelaDetalhe.IsEmpty) then
    begin
      FTabelaDetalhe.Delete;
      FTabelaDetalhe.ApplyUpdates(0);
      FTabelaDetalhe.Refresh;
    end;
end;

procedure TfrFormPadraoConsultaDetalhePEDSCI.FormCreate(Sender: TObject);
begin
  inherited;
  FTabelaDetalhe := setTabelaDetalhe;
  if Assigned(FTabelaDetalhe) then
    begin
      dsDetalhe.DataSet           := FTabelaDetalhe;
      FTabelaDetalhe.MasterFields := setCamposChaveDetalhe;
      FTabelaDetalhe.MasterSource := dsConsulta;
    end;

end;

function TfrFormPadraoConsultaDetalhePEDSCI.getPodeExcluirDetalhe: Boolean;
begin
  Result:= MessageDlg('Deseja excluir esse registro?',mtWarning,[mbYes,mbNo], 0) = mrYes;
end;

end.
